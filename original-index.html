<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>üìç Plot Planner - Smart Plot Investment Planning</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <style>
            :root {
                --primary-color: #2563eb;
                --secondary-color: #10b981;
                --accent-color: #f59e0b;
                --danger-color: #ef4444;
                --background: #f8fafc;
                --surface: #ffffff;
                --text-primary: #1e293b;
                --text-secondary: #64748b;
                --border: #e2e8f0;
                --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background: var(--background);
                color: var(--text-primary);
                line-height: 1.6;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                background: var(--surface);
                border-radius: 12px;
                padding: 30px;
                margin-bottom: 30px;
                box-shadow: var(--shadow);
                text-align: center;
            }

            .header h1 {
                font-size: 2.5rem;
                color: var(--primary-color);
                margin-bottom: 10px;
            }

            .header p {
                font-size: 1.2rem;
                color: var(--text-secondary);
            }

            .nav-tabs {
                display: flex;
                background: var(--surface);
                border-radius: 12px;
                padding: 5px;
                margin-bottom: 30px;
                box-shadow: var(--shadow);
                gap: 5px;
            }

            .nav-tab {
                flex: 1;
                padding: 15px 20px;
                background: transparent;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 600;
                color: var(--text-secondary);
            }

            .nav-tab.active {
                background: var(--primary-color);
                color: white;
                box-shadow: var(--shadow);
            }

            .tab-content {
                display: none;
                animation: fadeIn 0.3s ease;
            }

            .tab-content.active {
                display: block;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-bottom: 30px;
            }

            .control-panel {
                background: var(--surface);
                border-radius: 12px;
                padding: 25px;
                box-shadow: var(--shadow);
            }

            .control-panel h3 {
                color: var(--primary-color);
                margin-bottom: 20px;
                font-size: 1.3rem;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .input-group {
                margin-bottom: 20px;
            }

            .input-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: var(--text-primary);
            }

            .slider-container {
                position: relative;
                margin-bottom: 15px;
            }

            .slider {
                width: 100%;
                height: 6px;
                border-radius: 3px;
                background: var(--border);
                outline: none;
                -webkit-appearance: none;
            }

            .slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: var(--primary-color);
                cursor: pointer;
                box-shadow: var(--shadow);
            }

            .slider-value {
                position: absolute;
                right: 0;
                top: -30px;
                background: var(--primary-color);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .input-field {
                width: 100%;
                padding: 12px;
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.3s ease;
            }

            .input-field:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            }

            .results-card {
                background: var(--surface);
                border-radius: 12px;
                padding: 25px;
                box-shadow: var(--shadow);
            }

            .metric-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid var(--border);
            }

            .metric-row:last-child {
                border-bottom: none;
            }

            .metric-label {
                font-weight: 600;
                color: var(--text-primary);
            }

            .metric-value {
                font-weight: 700;
                color: var(--primary-color);
                font-size: 1.1rem;
            }

            .chart-container {
                background: var(--surface);
                border-radius: 12px;
                padding: 25px;
                box-shadow: var(--shadow);
                margin-bottom: 20px;
            }

            .plot-card {
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 15px;
                transition: all 0.3s ease;
            }

            .plot-card:hover {
                box-shadow: var(--shadow-lg);
                transform: translateY(-2px);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background: var(--primary-color);
                color: white;
            }

            .btn-primary:hover {
                background: #1d4ed8;
                transform: translateY(-1px);
            }

            .btn-secondary {
                background: var(--secondary-color);
                color: white;
            }

            .btn-secondary:hover {
                background: #059669;
                transform: translateY(-1px);
            }

            .btn-danger {
                background: var(--danger-color);
                color: white;
            }

            .btn-danger:hover {
                background: #dc2626;
                transform: translateY(-1px);
            }

            .warning-box {
                background: #fef3c7;
                border: 1px solid #f59e0b;
                border-radius: 8px;
                padding: 15px;
                margin: 15px 0;
                color: #92400e;
            }

            .success-box {
                background: #d1fae5;
                border: 1px solid #10b981;
                border-radius: 8px;
                padding: 15px;
                margin: 15px 0;
                color: #065f46;
            }

            .grid-3 {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .grid-2 {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                gap: 20px;
            }

            @media (max-width: 768px) {
                .dashboard-grid,
                .grid-3,
                .grid-2 {
                    grid-template-columns: 1fr;
                }

                .header h1 {
                    font-size: 1.8rem;
                }

                .nav-tabs {
                    display: none;
                }

                .hamburger-menu {
                    display: flex !important;
                    position: relative;
                    background: white;
                    border: 1px solid #e2e8f0;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    flex-shrink: 0;
                    visibility: visible !important;
                }

                .nav-tabs {
                    display: none !important;
                }

                .mobile-nav-overlay.active {
                    display: block !important;
                }

                .mobile-nav-menu {
                    display: block !important;
                }

                .mobile-nav-overlay.active {
                    display: block !important;
                }

                .mobile-nav-menu {
                    display: block !important;
                }

                .mobile-current-tab {
                    display: block;
                }

                .container {
                    padding: 10px;
                }

                .header {
                    padding: 20px;
                    display: flex !important;
                    justify-content: space-between;
                    align-items: center;
                }

                .header-content {
                    flex: 1;
                }

                .nav-tab {
                    margin-bottom: 5px;
                }

                .input-field {
                    font-size: 16px;
                    padding: 15px;
                }

                .btn {
                    padding: 15px 20px;
                    font-size: 16px;
                    min-height: 44px;
                }

                .slider {
                    height: 8px;
                }

                .slider::-webkit-slider-thumb {
                    width: 24px;
                    height: 24px;
                }

                .control-panel {
                    padding: 20px;
                }

                .results-card {
                    padding: 20px;
                }

                .metric-row {
                    padding: 15px 0;
                }

                .chart-container {
                    margin-bottom: 15px;
                }

                .timeline-item {
                    padding: 15px !important;
                    margin: 10px 0 !important;
                }

                .plot-details {
                    padding: 15px;
                }
            }

            .loading {
                opacity: 0.6;
                pointer-events: none;
            }

            .fade-in {
                animation: fadeIn 0.3s ease;
            }

            .slide-up {
                animation: slideUp 0.3s ease;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .text-red-600 {
                color: #dc2626 !important;
            }

            .text-yellow-600 {
                color: #d97706 !important;
            }

            .text-green-600 {
                color: #059669 !important;
            }

            .hamburger-menu {
                display: none;
                flex-direction: column;
                cursor: pointer;
                padding: 12px;
                position: relative;
                z-index: 1000;
                background: var(--surface);
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                border: 1px solid var(--border);
                min-width: 44px;
                min-height: 44px;
                justify-content: center;
                align-items: center;
                flex-shrink: 0;
                transition: all 0.3s ease;
            }

            .hamburger-menu:hover {
                background: #f8fafc;
                transform: scale(1.05);
            }

            .hamburger-menu:active {
                transform: scale(0.95);
            }

            .hamburger-menu.show {
                display: flex !important;
            }

            @media (max-width: 768px) {
                .hamburger-menu {
                    display: flex !important;
                }
            }

            .hamburger-menu span {
                width: 22px;
                height: 3px;
                background: var(--primary-color);
                margin: 2px 0;
                transition: 0.3s;
                border-radius: 2px;
                display: block;
            }

            .hamburger-menu.active span:nth-child(1) {
                transform: rotate(-45deg) translate(-5px, 6px);
            }

            .hamburger-menu.active span:nth-child(2) {
                opacity: 0;
            }

            .hamburger-menu.active span:nth-child(3) {
                transform: rotate(45deg) translate(-5px, -6px);
            }

            .mobile-nav-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            .mobile-nav-menu {
                display: none;
                position: fixed;
                top: 0;
                right: -300px;
                width: 280px;
                height: 100%;
                background: var(--surface);
                box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
                transition: right 0.3s ease;
                z-index: 1000;
                padding: 20px;
                overflow-y: auto;
            }

            .mobile-nav-menu.active {
                right: 0;
            }

            .mobile-nav-menu h3 {
                color: var(--primary-color);
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 1px solid var(--border);
            }

            .mobile-nav-item {
                display: block;
                padding: 15px 0;
                color: var(--text-primary);
                text-decoration: none;
                border-bottom: 1px solid var(--border);
                transition: all 0.3s ease;
                min-height: 44px;
                display: flex;
                align-items: center;
            }

            .mobile-nav-item:hover {
                color: var(--primary-color);
                padding-left: 10px;
            }

            .mobile-current-tab {
                display: none;
                font-size: 0.9rem;
                color: var(--primary-color);
                font-weight: bold;
                margin-top: 5px;
            }

            .mobile-nav-item.active {
                color: var(--primary-color);
                font-weight: bold;
            }

            .mobile-nav-item i {
                margin-right: 10px;
                width: 20px;
            }

            .chart-container {
                position: relative;
                overflow: hidden;
            }

            .chart-container canvas {
                display: block;
                max-width: 100%;
                max-height: 300px;
            }

            .timeline-item {
                position: relative;
                margin: 15px 0;
                padding: 15px;
                border-radius: 8px;
                transition: all 0.3s ease;
            }

            .timeline-item:hover {
                transform: translateX(5px);
                box-shadow: var(--shadow-lg);
            }

            .timeline-connector {
                position: absolute;
                left: -2px;
                top: 0;
                bottom: 0;
                width: 3px;
                background: linear-gradient(to bottom, #10b981, #059669);
                border-radius: 2px;
            }

            .capacity-indicator {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8rem;
                font-weight: 600;
                margin-left: 10px;
            }

            .capacity-high {
                background: #d1fae5;
                color: #065f46;
            }

            .capacity-medium {
                background: #fef3c7;
                color: #92400e;
            }

            .capacity-low {
                background: #fee2e2;
                color: #991b1b;
            }

            .timeline-year {
                font-size: 1.1rem;
                font-weight: bold;
                color: #1e293b;
                margin-bottom: 5px;
            }

            .timeline-year.current {
                color: #2563eb;
            }

            .timeline-year.has-plots {
                color: #059669;
            }

            .plot-purchase-badge {
                display: inline-block;
                padding: 2px 8px;
                background: #2563eb;
                color: white;
                border-radius: 10px;
                font-size: 0.8rem;
                margin-left: 10px;
            }

            .plot-details {
                margin: 10px 0;
                padding: 10px;
                background: rgba(37, 99, 235, 0.1);
                border-radius: 6px;
                border-left: 3px solid #2563eb;
            }

            .plot-details h5 {
                margin-bottom: 8px;
                color: #2563eb;
                font-size: 0.9rem;
            }

            .plot-item {
                margin-bottom: 5px;
                font-size: 0.9rem;
                color: #374151;
            }

            .risk-analysis {
                margin-top: 10px;
                padding: 8px;
                border-radius: 4px;
                font-size: 0.9rem;
            }

            .risk-analysis.high {
                background: #fee2e2;
                color: #991b1b;
                border-left: 4px solid #ef4444;
            }

            .risk-analysis.moderate {
                background: #fef3c7;
                color: #92400e;
                border-left: 4px solid #f59e0b;
            }

            .risk-analysis.low {
                background: #d1fae5;
                color: #065f46;
                border-left: 4px solid #10b981;
            }

            .timeline-summary {
                background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
                border-radius: 8px;
                padding: 20px;
                margin-top: 30px;
                color: white;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }

            .timeline-summary h4 {
                color: white;
                margin-bottom: 15px;
                font-size: 1.2rem;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <header class="header">
                <div class="header-content">
                    <h1><i class="fas fa-map-marked-alt"></i> Plot Planner</h1>
                    <p>
                        Smart planning tool for plot investments and financial
                        analysis
                    </p>
                    <div class="mobile-current-tab" id="mobileCurrentTab">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </div>
                </div>
                <div
                    class="hamburger-menu show"
                    onclick="toggleMobileNav()"
                    id="hamburgerMenu"
                    title="Open Menu"
                >
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </header>

            <!-- Mobile Navigation -->
            <div class="mobile-nav-overlay" onclick="closeMobileNav()"></div>
            <div class="mobile-nav-menu">
                <h3><i class="fas fa-map-marked-alt"></i> Plot Planner</h3>
                <a
                    href="#"
                    class="mobile-nav-item active"
                    onclick="showTabMobile('dashboard')"
                >
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a
                    href="#"
                    class="mobile-nav-item"
                    onclick="showTabMobile('current')"
                >
                    <i class="fas fa-home"></i> Current Home
                </a>
                <a
                    href="#"
                    class="mobile-nav-item"
                    onclick="showTabMobile('future')"
                >
                    <i class="fas fa-map-marked-alt"></i> Future Plots
                </a>
                <a
                    href="#"
                    class="mobile-nav-item"
                    onclick="showTabMobile('timeline')"
                >
                    <i class="fas fa-clock"></i> Timeline
                </a>
            </div>

            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="nav-tab" onclick="showTab('current')">
                    <i class="fas fa-home"></i> Current Home
                </button>
                <button class="nav-tab" onclick="showTab('future')">
                    <i class="fas fa-map-marked-alt"></i> Future Plots
                </button>

                <button class="nav-tab" onclick="showTab('timeline')">
                    <i class="fas fa-clock"></i> Timeline
                </button>
            </nav>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="dashboard-grid">
                    <div class="control-panel">
                        <h3><i class="fas fa-sliders-h"></i> Quick Controls</h3>
                        <div class="input-group">
                            <label>Current Monthly Salary (‚Çπ)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="quickSalary"
                                value="88000"
                                oninput="debouncedUpdate();"
                            />
                        </div>
                        <div class="input-group">
                            <label>Annual Growth Rate (%)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="quickGrowth"
                                    min="20"
                                    max="100"
                                    value="58"
                                    oninput="debouncedUpdate();"
                                />
                                <span class="slider-value" id="quickGrowthValue"
                                    >58%</span
                                >
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Interest Rate (%)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="quickInterest"
                                    min="7"
                                    max="12"
                                    step="0.1"
                                    value="8"
                                    oninput="debouncedUpdate();"
                                />
                                <span
                                    class="slider-value"
                                    id="quickInterestValue"
                                    >8.0%</span
                                >
                            </div>
                        </div>
                    </div>

                    <div class="results-card">
                        <h3><i class="fas fa-chart-bar"></i> Quick Summary</h3>
                        <div class="metric-row">
                            <span class="metric-label"
                                >Current EMI Capacity</span
                            >
                            <span class="metric-value" id="quickEMICapacity"
                                >‚Çπ35,200</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label"
                                >Available for Plots</span
                            >
                            <span class="metric-value" id="quickAvailable"
                                >‚Çπ14,402</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label"
                                >Total Debt Capacity</span
                            >
                            <span class="metric-value" id="quickDebtCapacity"
                                >‚Çπ42,24,000</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Risk Level</span>
                            <span class="metric-value" id="quickRisk">Low</span>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <div style="margin-bottom: 15px; text-align: center">
                        <h3 style="color: #1e293b; margin-bottom: 10px">
                            <i class="fas fa-chart-line"></i> Salary Growth
                            Projection
                        </h3>
                        <div
                            style="
                                display: flex;
                                justify-content: center;
                                gap: 20px;
                                margin-bottom: 10px;
                            "
                        >
                            <div
                                style="
                                    padding: 8px 16px;
                                    background: #2563eb;
                                    color: white;
                                    border-radius: 20px;
                                    font-size: 0.9rem;
                                "
                            >
                                <i class="fas fa-arrow-up"></i>
                                <span id="growthIndicator">58%</span> Annual
                                Growth
                            </div>
                            <div
                                style="
                                    padding: 8px 16px;
                                    background: #10b981;
                                    color: white;
                                    border-radius: 20px;
                                    font-size: 0.9rem;
                                "
                            >
                                <i class="fas fa-coins"></i>
                                <span id="currentSalaryIndicator">‚Çπ88,000</span>
                                Current
                            </div>
                            <div
                                style="
                                    padding: 8px 16px;
                                    background: #f59e0b;
                                    color: white;
                                    border-radius: 20px;
                                    font-size: 0.9rem;
                                "
                            >
                                <i class="fas fa-trophy"></i>
                                <span id="projectedSalaryIndicator">‚Çπ6.9L</span>
                                in 8 years
                            </div>
                        </div>
                    </div>
                    <div
                        style="
                            position: relative;
                            height: 300px;
                            width: 100%;
                            overflow: hidden;
                        "
                    >
                        <canvas
                            id="dashboardChart"
                            style="max-height: 300px"
                        ></canvas>
                    </div>
                </div>
            </div>

            <!-- Current Home Tab -->
            <div id="current-tab" class="tab-content">
                <div class="grid-2">
                    <div class="control-panel">
                        <h3><i class="fas fa-home"></i> Property Details</h3>
                        <div class="input-group">
                            <label>Plot Size (sq ft)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="plotSize"
                                    min="1000"
                                    max="2500"
                                    value="1500"
                                    oninput="updateCurrentCalculations()"
                                />
                                <span class="slider-value" id="plotSizeValue"
                                    >1500</span
                                >
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Construction Area (sq ft)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="constructionSize"
                                    min="1000"
                                    max="3000"
                                    value="1500"
                                    oninput="updateCurrentCalculations()"
                                />
                                <span
                                    class="slider-value"
                                    id="constructionSizeValue"
                                    >1500</span
                                >
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Plot Rate (‚Çπ/sq ft)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="plotRate"
                                value="1000"
                                oninput="updateCurrentCalculations()"
                            />
                        </div>
                        <div class="input-group">
                            <label>Construction Rate (‚Çπ/sq ft)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="constructionRate"
                                value="1200"
                                oninput="updateCurrentCalculations()"
                            />
                        </div>
                    </div>

                    <div class="control-panel">
                        <h3>
                            <i class="fas fa-coins"></i> Financial Parameters
                        </h3>
                        <div class="input-group">
                            <label>Interest Rate (%)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="interestRate"
                                    min="7"
                                    max="12"
                                    step="0.1"
                                    value="8"
                                    oninput="updateCurrentCalculations()"
                                />
                                <span
                                    class="slider-value"
                                    id="interestRateValue"
                                    >8.0%</span
                                >
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Loan Tenure (years)</label>
                            <select
                                class="input-field"
                                id="loanTenure"
                                onchange="updateCurrentCalculations()"
                            >
                                <option value="15">15 years</option>
                                <option value="20" selected>20 years</option>
                                <option value="25">25 years</option>
                                <option value="30">30 years</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Down Payment (%)</label>
                            <div class="slider-container">
                                <input
                                    type="range"
                                    class="slider"
                                    id="downPayment"
                                    min="10"
                                    max="30"
                                    value="20"
                                    oninput="updateCurrentCalculations()"
                                />
                                <span class="slider-value" id="downPaymentValue"
                                    >20%</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="results-card">
                        <h3><i class="fas fa-calculator"></i> Loan Summary</h3>
                        <div class="metric-row">
                            <span class="metric-label">Total Project Cost</span>
                            <span class="metric-value" id="totalProjectCost"
                                >‚Çπ33,00,000</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Loan Amount</span>
                            <span class="metric-value" id="loanAmount"
                                >‚Çπ26,40,000</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Monthly EMI</span>
                            <span class="metric-value" id="monthlyEMI"
                                >‚Çπ20,798</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Total Interest</span>
                            <span class="metric-value" id="totalInterest"
                                >‚Çπ23,31,520</span
                            >
                        </div>
                    </div>

                    <div class="results-card">
                        <h3>
                            <i class="fas fa-percentage"></i> Financial Health
                        </h3>
                        <div class="metric-row">
                            <span class="metric-label">Current FOIR</span>
                            <span class="metric-value" id="currentFOIR"
                                >23.6%</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label"
                                >Available EMI Capacity</span
                            >
                            <span class="metric-value" id="availableEMI"
                                >‚Çπ14,402</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Loan End Year</span>
                            <span class="metric-value" id="loanEndYear"
                                >2045</span
                            >
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Risk Assessment</span>
                            <span class="metric-value" id="riskAssessment"
                                >Low Risk</span
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Future Plots Tab -->
            <div id="future-tab" class="tab-content">
                <div class="control-panel">
                    <h3><i class="fas fa-plus-circle"></i> Add New Plot</h3>
                    <div class="grid-3">
                        <div class="input-group">
                            <label>Plot Size (sq ft)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="newPlotSize"
                                value="1200"
                                min="500"
                                max="5000"
                            />
                        </div>
                        <div class="input-group">
                            <label>Purchase Year</label>
                            <select
                                class="input-field"
                                id="newPlotYear"
                                onchange="updateYearDescription()"
                            >
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029" selected>2029</option>
                                <option value="2030">2030</option>
                                <option value="2031">2031</option>
                                <option value="2032">2032</option>
                                <option value="2033">2033</option>
                                <option value="2034">2034</option>
                                <option value="2035">2035</option>
                                <option value="2036">2036</option>
                                <option value="2037">2037</option>
                                <option value="2038">2038</option>
                                <option value="2039">2039</option>
                                <option value="2040">2040</option>
                                <option value="2041">2041</option>
                                <option value="2042">2042</option>
                                <option value="2043">2043</option>
                                <option value="2044">2044</option>
                                <option value="2045">2045</option>
                                <option value="2046">2046</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Plot Rate (‚Çπ/sq ft)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="newPlotRate"
                                value="1000"
                                min="500"
                                max="3000"
                            />
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addPlot()">
                        <i class="fas fa-plus"></i> Add Plot
                    </button>
                </div>

                <div id="plotsContainer">
                    <!-- Dynamic plots will be added here -->
                </div>
            </div>

            <!-- Timeline Tab -->
            <div id="timeline-tab" class="tab-content">
                <div class="control-panel">
                    <h3>
                        <i class="fas fa-clock"></i> Year-wise Financial
                        Timeline
                    </h3>
                    <p>
                        Track your plot acquisitions and their impact on FOIR
                        and financial risk over time
                    </p>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Timeline Duration (years)</label>
                            <select
                                class="input-field"
                                id="timelineDuration"
                                onchange="updateTimelineView()"
                            >
                                <option value="10">10 years</option>
                                <option value="15" selected>15 years</option>
                                <option value="20">20 years</option>
                                <option value="25">25 years</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Risk Threshold (%)</label>
                            <input
                                type="number"
                                class="input-field"
                                id="riskThreshold"
                                value="35"
                                min="25"
                                max="45"
                                onchange="updateTimelineView()"
                            />
                        </div>
                    </div>
                </div>

                <div id="timelineContainer" class="results-card">
                    <div id="timelineContent"></div>
                </div>
            </div>
        </div>

        <script>
            // Global variables
            let plots = [];
            let currentScenario = "current";
            let dashboardChart, timelineChart, scenarioChart, foirChart;

            // Initialize
            document.addEventListener("DOMContentLoaded", function () {
                initializeCharts();
                loadSavedData();
                updateAllCalculations();
                // Ensure indicators are updated immediately on page load
                updateGrowthIndicators();
                // Purchase year options are now hardcoded in HTML
                // Initialize year description
                setTimeout(() => {
                    updateYearDescription();
                }, 200);
                // Initialize mobile navigation with delay
                setTimeout(() => {
                    initializeMobileNav();
                }, 100);
            });

            // Tab switching
            function showTab(tabName) {
                document
                    .querySelectorAll(".tab-content")
                    .forEach((tab) => tab.classList.remove("active"));
                document
                    .querySelectorAll(".nav-tab")
                    .forEach((tab) => tab.classList.remove("active"));

                document
                    .getElementById(tabName + "-tab")
                    .classList.add("active");
                if (event && event.target) {
                    event.target.classList.add("active");
                }

                if (tabName === "timeline") {
                    updateTimelineCharts();
                }
            }

            function toggleMobileNav() {
                const overlay = document.querySelector(".mobile-nav-overlay");
                const menu = document.querySelector(".mobile-nav-menu");
                const hamburger = document.querySelector(".hamburger-menu");

                overlay.classList.toggle("active");
                menu.classList.toggle("active");
                hamburger.classList.toggle("active");
            }

            function closeMobileNav() {
                const overlay = document.querySelector(".mobile-nav-overlay");
                const menu = document.querySelector(".mobile-nav-menu");
                const hamburger = document.querySelector(".hamburger-menu");

                overlay.classList.remove("active");
                menu.classList.remove("active");
                hamburger.classList.remove("active");
            }

            function showTabMobile(tabName) {
                // Update active mobile nav item
                document
                    .querySelectorAll(".mobile-nav-item")
                    .forEach((item) => {
                        item.classList.remove("active");
                    });
                event.target.classList.add("active");

                // Update mobile current tab indicator
                updateMobileCurrentTab(tabName, event.target.innerHTML);

                // Switch tab
                showTab(tabName);

                // Close mobile nav
                closeMobileNav();
            }

            function updateMobileCurrentTab(tabName, tabHTML) {
                const mobileCurrentTab =
                    document.getElementById("mobileCurrentTab");
                if (mobileCurrentTab) {
                    mobileCurrentTab.innerHTML = tabHTML;
                }
            }

            // Purchase year options are now hardcoded in HTML for better reliability

            function updateYearDescription() {
                const selectedYear = parseInt(
                    document.getElementById("newPlotYear").value,
                );
                const currentYear = new Date().getFullYear();
                const yearsFromNow = selectedYear - currentYear;
                const descriptionEl =
                    document.getElementById("yearDescription");

                if (descriptionEl) {
                    const currentSalary =
                        parseInt(
                            document.getElementById("quickSalary").value,
                        ) || 88000;
                    const forecastedSalary =
                        calculateForecastedSalary(selectedYear);
                    const growthRate = parseInt(
                        document.getElementById("quickGrowth").value,
                    );

                    let timeDescription = "";
                    let bgColor = "#f8fafc";
                    let borderColor = "#2563eb";

                    if (yearsFromNow === 0) {
                        timeDescription = "Current year";
                        bgColor = "#fef3c7";
                        borderColor = "#f59e0b";
                    } else if (yearsFromNow === 1) {
                        timeDescription = "Next year";
                    } else {
                        timeDescription = `${yearsFromNow} years from now`;
                    }

                    const growthPercentage =
                        yearsFromNow === 0
                            ? 0
                            : ((forecastedSalary - currentSalary) /
                                  currentSalary) *
                              100;

                    descriptionEl.innerHTML = `
                        <div style="padding: 8px 12px; background: ${bgColor}; border-radius: 6px; border-left: 3px solid ${borderColor};">
                            <strong>Purchase Year ${selectedYear} (${timeDescription}):</strong><br>
                            ‚Ä¢ Forecasted Salary: ‚Çπ${Math.round(forecastedSalary).toLocaleString()}<br>
                            ‚Ä¢ Growth from current: ${growthPercentage.toFixed(1)}%<br>
                            ‚Ä¢ EMI Affordability: ‚Çπ${Math.round(forecastedSalary * 0.4).toLocaleString()} (40% FOIR)
                        </div>
                    `;
                }
            }

            // Removed setQuickYear function - no longer needed

            function initializeMobileNav() {
                // Force hamburger menu visibility on mobile using CSS class
                const hamburgerMenu = document.querySelector(".hamburger-menu");

                if (hamburgerMenu) {
                    if (window.innerWidth <= 768) {
                        hamburgerMenu.classList.add("show");
                    } else {
                        hamburgerMenu.classList.remove("show");
                    }
                }

                // Add keyboard support
                document.addEventListener("keydown", function (e) {
                    if (e.key === "Escape") {
                        closeMobileNav();
                    }
                });

                // Handle window resize
                window.addEventListener("resize", function () {
                    const hamburgerMenu =
                        document.querySelector(".hamburger-menu");
                    if (hamburgerMenu) {
                        if (window.innerWidth <= 768) {
                            hamburgerMenu.classList.add("show");
                        } else {
                            hamburgerMenu.classList.remove("show");
                            closeMobileNav();
                        }
                    }
                });

                // Prevent body scroll when mobile nav is open
                const mobileNavOverlay = document.querySelector(
                    ".mobile-nav-overlay",
                );
                if (mobileNavOverlay) {
                    mobileNavOverlay.addEventListener(
                        "touchmove",
                        function (e) {
                            e.preventDefault();
                        },
                    );
                }
            }

            // Chart initialization
            function initializeCharts() {
                // Clean up existing chart if it exists
                if (dashboardChart) {
                    dashboardChart.destroy();
                }

                // Dashboard chart
                const ctx = document
                    .getElementById("dashboardChart")
                    .getContext("2d");
                dashboardChart = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: "Salary Growth",
                                data: [],
                                borderColor: "#2563eb",
                                backgroundColor: "rgba(37, 99, 235, 0.1)",
                                tension: 0.4,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        resizeDelay: 0,
                        interaction: {
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: "top",
                                labels: {
                                    color: "#1e293b",
                                    font: {
                                        size: 12,
                                        weight: "bold",
                                    },
                                },
                            },
                            tooltip: {
                                backgroundColor: "rgba(0, 0, 0, 0.8)",
                                titleColor: "#fff",
                                bodyColor: "#fff",
                                cornerRadius: 8,
                                callbacks: {
                                    label: function (context) {
                                        return (
                                            "Salary: ‚Çπ" +
                                            context.parsed.y.toLocaleString()
                                        );
                                    },
                                },
                            },
                            title: {
                                display: true,
                                text: "Salary Growth Projection",
                                color: "#1e293b",
                                font: {
                                    size: 16,
                                    weight: "bold",
                                },
                            },
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: "#e2e8f0",
                                },
                                ticks: {
                                    color: "#64748b",
                                    callback: function (value) {
                                        if (value >= 1000000) {
                                            return (
                                                "‚Çπ" +
                                                (value / 1000000).toFixed(1) +
                                                "M"
                                            );
                                        } else if (value >= 1000) {
                                            return (
                                                "‚Çπ" +
                                                (value / 1000).toFixed(0) +
                                                "K"
                                            );
                                        } else {
                                            return "‚Çπ" + value.toLocaleString();
                                        }
                                    },
                                },
                            },
                            x: {
                                grid: {
                                    color: "#e2e8f0",
                                },
                                ticks: {
                                    color: "#64748b",
                                },
                            },
                        },
                        animation: {
                            duration: 1000,
                            easing: "easeInOutQuart",
                        },
                    },
                });

                // Initialize with current values
                updateDashboardChart();

                // Ensure all indicators are properly initialized
                updateQuickCalculations();
                updateGrowthIndicators();
            }

            // Debounced update function to prevent excessive chart updates
            function debouncedUpdate() {
                // Update indicators immediately for better responsiveness
                updateGrowthIndicators();

                clearTimeout(window.updateTimeout);
                window.updateTimeout = setTimeout(() => {
                    updateQuickCalculations();
                    updateDashboardChart();
                }, 150);
            }

            // Update dashboard chart with current salary and growth values
            function updateDashboardChart() {
                if (!dashboardChart || !dashboardChart.data) return;

                const currentSalary =
                    parseInt(document.getElementById("quickSalary").value) ||
                    88000;
                const growthRate =
                    parseInt(document.getElementById("quickGrowth").value) /
                    100;
                const currentYear = new Date().getFullYear();

                // Generate 8 years of data for better visualization
                const years = [];
                const salaryData = [];
                const emiCapacityData = [];

                for (let i = 0; i < 8; i++) {
                    const year = currentYear + i;
                    const salary = currentSalary * Math.pow(1 + growthRate, i);
                    const emiCapacity = salary * 0.4; // 40% FOIR
                    years.push(year.toString());
                    salaryData.push(Math.round(salary));
                    emiCapacityData.push(Math.round(emiCapacity));
                }

                // Update chart data with multiple datasets
                dashboardChart.data.labels = years;
                dashboardChart.data.datasets[0].data = salaryData;
                dashboardChart.data.datasets[0].label = `Salary Growth (${(growthRate * 100).toFixed(0)}% annually)`;

                // Update chart title dynamically
                const finalSalary = salaryData[salaryData.length - 1];
                dashboardChart.options.plugins.title.text = `Salary Growth: ‚Çπ${currentSalary.toLocaleString()} ‚Üí ‚Çπ${finalSalary.toLocaleString()} (${(growthRate * 100).toFixed(0)}% annually)`;

                // Add EMI capacity dataset if it doesn't exist
                if (dashboardChart.data.datasets.length < 2) {
                    dashboardChart.data.datasets.push({
                        label: "EMI Capacity (40% FOIR)",
                        data: emiCapacityData,
                        borderColor: "#10b981",
                        backgroundColor: "rgba(16, 185, 129, 0.1)",
                        tension: 0.4,
                        borderDash: [5, 5],
                    });
                } else {
                    dashboardChart.data.datasets[1].data = emiCapacityData;
                }

                try {
                    dashboardChart.update("none");
                } catch (error) {
                    console.warn("Chart update failed:", error);
                    // Reinitialize chart if update fails
                    initializeCharts();
                }
            }

            // Update growth indicators
            function updateGrowthIndicators() {
                try {
                    const currentSalary =
                        parseInt(
                            document.getElementById("quickSalary").value,
                        ) || 88000;
                    const growthRate = parseInt(
                        document.getElementById("quickGrowth").value,
                    );

                    // Update growth indicator
                    const growthEl = document.getElementById("growthIndicator");
                    if (growthEl) {
                        growthEl.textContent = growthRate + "%";
                    }

                    // Update current salary indicator
                    const salaryEl = document.getElementById(
                        "currentSalaryIndicator",
                    );
                    if (salaryEl) {
                        salaryEl.textContent =
                            "‚Çπ" + currentSalary.toLocaleString();
                    }

                    // Calculate and display projected salary
                    const projectedSalary =
                        currentSalary * Math.pow(1 + growthRate / 100, 8);
                    const projectedText =
                        projectedSalary >= 1000000
                            ? "‚Çπ" + (projectedSalary / 1000000).toFixed(1) + "M"
                            : "‚Çπ" + (projectedSalary / 100000).toFixed(1) + "L";

                    const projectedEl = document.getElementById(
                        "projectedSalaryIndicator",
                    );
                    if (projectedEl) {
                        projectedEl.textContent = projectedText;
                    }
                } catch (error) {
                    console.warn("Error updating growth indicators:", error);
                }
            }

            // Save/Load functionality
            function saveData() {
                const data = {
                    plots: plots,
                    currentInputs: {
                        plotSize: document.getElementById("plotSize").value,
                        constructionSize:
                            document.getElementById("constructionSize").value,
                        plotRate: document.getElementById("plotRate").value,
                        constructionRate:
                            document.getElementById("constructionRate").value,
                        interestRate:
                            document.getElementById("interestRate").value,
                        loanTenure: document.getElementById("loanTenure").value,
                        downPayment:
                            document.getElementById("downPayment").value,
                    },
                };
                localStorage.setItem("homeLoanV2", JSON.stringify(data));
            }

            function loadSavedData() {
                const saved = localStorage.getItem("homeLoanV2");
                if (saved) {
                    const data = JSON.parse(saved);
                    plots = data.plots || [];

                    // Restore inputs
                    if (data.currentInputs) {
                        Object.keys(data.currentInputs).forEach((key) => {
                            const element = document.getElementById(key);
                            if (element)
                                element.value = data.currentInputs[key];
                        });
                    }

                    renderPlots();
                }
            }

            // Plot management
            function addPlot() {
                const size = parseInt(
                    document.getElementById("newPlotSize").value,
                );
                const year = parseInt(
                    document.getElementById("newPlotYear").value,
                );
                const rate = parseInt(
                    document.getElementById("newPlotRate").value,
                );

                // Validate inputs
                if (isNaN(size) || size < 500 || size > 5000) {
                    alert(
                        "Please enter a valid plot size between 500 and 5000 sq ft",
                    );
                    return;
                }

                if (isNaN(year) || year < new Date().getFullYear()) {
                    alert("Please enter a valid future year");
                    return;
                }

                if (isNaN(rate) || rate < 500 || rate > 3000) {
                    alert(
                        "Please enter a valid rate between ‚Çπ500 and ‚Çπ3000 per sq ft",
                    );
                    return;
                }

                const plot = {
                    id: Date.now(),
                    size: size,
                    year: year,
                    rate: rate,
                    loanAmount: 0,
                    emi: 0,
                };

                plot.loanAmount = plot.size * plot.rate * 0.8; // 80% loan
                plot.emi = calculateEMI(plot.loanAmount, 8.5, 10); // 10 year plot loan

                plots.push(plot);
                renderPlots();
                saveData();
                updateAllCalculations();
            }

            function removePlot(id) {
                plots = plots.filter((plot) => plot.id !== id);
                renderPlots();
                saveData();
                updateAllCalculations();
            }

            function renderPlots() {
                const container = document.getElementById("plotsContainer");
                container.innerHTML = "";

                plots.forEach((plot) => {
                    const div = document.createElement("div");
                    div.className = "plot-card";
                    div.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4>Plot ${plot.year}</h4>
                            <p>Size: ${plot.size} sq ft @ ‚Çπ${plot.rate}/sq ft</p>
                            <p>Loan: ‚Çπ${plot.loanAmount.toLocaleString()} | EMI: ‚Çπ${Math.round(plot.emi).toLocaleString()}</p>
                        </div>
                        <button class="btn btn-danger" onclick="removePlot(${plot.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                    container.appendChild(div);
                });
            }

            // Calculations
            function calculateEMI(principal, rate, years) {
                const monthlyRate = rate / (12 * 100);
                const numPayments = years * 12;

                if (monthlyRate === 0) return principal / numPayments;

                return (
                    (principal *
                        monthlyRate *
                        Math.pow(1 + monthlyRate, numPayments)) /
                    (Math.pow(1 + monthlyRate, numPayments) - 1)
                );
            }

            function updateCurrentCalculations() {
                const plotSize = parseInt(
                    document.getElementById("plotSize").value,
                );
                const constructionSize = parseInt(
                    document.getElementById("constructionSize").value,
                );
                const plotRate = parseInt(
                    document.getElementById("plotRate").value,
                );
                const constructionRate = parseInt(
                    document.getElementById("constructionRate").value,
                );
                const interestRate = parseFloat(
                    document.getElementById("interestRate").value,
                );
                const loanTenure = parseInt(
                    document.getElementById("loanTenure").value,
                );
                const downPayment = parseInt(
                    document.getElementById("downPayment").value,
                );

                const plotCost = plotSize * plotRate;
                const constructionCost = constructionSize * constructionRate;
                const totalCost = plotCost + constructionCost;
                const loanAmount = (totalCost * (100 - downPayment)) / 100;
                const monthlyEMI = calculateEMI(
                    loanAmount,
                    interestRate,
                    loanTenure,
                );
                const totalInterest = monthlyEMI * loanTenure * 12 - loanAmount;

                // Update displays
                document.getElementById("totalProjectCost").textContent =
                    "‚Çπ" + totalCost.toLocaleString();
                document.getElementById("loanAmount").textContent =
                    "‚Çπ" + Math.round(loanAmount).toLocaleString();
                document.getElementById("monthlyEMI").textContent =
                    "‚Çπ" + Math.round(monthlyEMI).toLocaleString();
                document.getElementById("totalInterest").textContent =
                    "‚Çπ" + Math.round(totalInterest).toLocaleString();

                // Update sliders
                document.getElementById("plotSizeValue").textContent = plotSize;
                document.getElementById("constructionSizeValue").textContent =
                    constructionSize;
                document.getElementById("interestRateValue").textContent =
                    interestRate + "%";
                document.getElementById("downPaymentValue").textContent =
                    downPayment + "%";

                saveData();
            }

            function calculateForecastedSalary(targetYear) {
                const currentSalary =
                    parseInt(document.getElementById("quickSalary").value) ||
                    88000;
                const currentYear = new Date().getFullYear();
                const yearsToGrow = targetYear - currentYear;

                // Using dashboard growth rate
                const growthRate =
                    parseInt(document.getElementById("quickGrowth").value) /
                    100;
                const forecastedSalary =
                    currentSalary * Math.pow(1 + growthRate, yearsToGrow);

                return Math.round(forecastedSalary);
            }

            // Removed updateCombinedAnalysis function - no longer needed

            function updateQuickCalculations() {
                const salary = parseInt(
                    document.getElementById("quickSalary").value,
                );
                const growth = parseInt(
                    document.getElementById("quickGrowth").value,
                );
                const interest = parseFloat(
                    document.getElementById("quickInterest").value,
                );

                const emiCapacity = salary * 0.4; // 40% FOIR
                const available = emiCapacity - salary * 0.236; // Assuming current home loan
                const debtCapacity = calculateMaxLoan(
                    emiCapacity,
                    interest,
                    20,
                );

                document.getElementById("quickGrowthValue").textContent =
                    growth + "%";
                document.getElementById("quickInterestValue").textContent =
                    interest.toFixed(1) + "%";

                document.getElementById("quickEMICapacity").textContent =
                    "‚Çπ" + Math.round(emiCapacity).toLocaleString();
                document.getElementById("quickAvailable").textContent =
                    "‚Çπ" + Math.round(available).toLocaleString();
                document.getElementById("quickDebtCapacity").textContent =
                    "‚Çπ" + Math.round(debtCapacity).toLocaleString();
                document.getElementById("quickRisk").textContent =
                    available > 10000 ? "Low" : "High";

                // Update combined analysis when dashboard values change
                // (removed - no longer needed)

                // Update acquisition timeline when dashboard values change
                updateAcquisitionTimeline();

                // Update dashboard chart when values change
                updateDashboardChart();

                // Update growth indicators immediately
                updateGrowthIndicators();
            }

            function calculateMaxLoan(emi, rate, years) {
                const monthlyRate = rate / (12 * 100);
                const numPayments = years * 12;
                return (
                    (emi * (Math.pow(1 + monthlyRate, numPayments) - 1)) /
                    (monthlyRate * Math.pow(1 + monthlyRate, numPayments))
                );
            }

            // Removed scenario functionality - no longer needed

            function updateTimelineCharts() {
                // Update timeline charts with current data
                // Implementation would go here
            }

            function updateTimelineView() {
                const duration =
                    parseInt(
                        document.getElementById("timelineDuration")?.value,
                    ) || 15;
                const riskThreshold =
                    parseInt(document.getElementById("riskThreshold")?.value) ||
                    35;
                const currentYear = new Date().getFullYear();
                const currentSalary =
                    parseInt(document.getElementById("quickSalary").value) ||
                    88000;
                const currentEMI =
                    parseInt(
                        document
                            .getElementById("monthlyEMI")
                            ?.textContent.replace(/[^0-9]/g, ""),
                    ) || 0;

                // Debug logging
                console.log("Timeline Update Debug:");
                console.log("- Current plots:", plots);
                console.log("- Duration:", duration);
                console.log("- Current year:", currentYear);
                console.log("- Current salary:", currentSalary);
                console.log("- Current EMI:", currentEMI);

                // Create timeline data
                let timelineData = [];
                let cumulativeEMI = currentEMI;

                for (
                    let year = currentYear;
                    year <= currentYear + duration;
                    year++
                ) {
                    const forecastedSalary = calculateForecastedSalary(year);
                    const plotsInYear = plots.filter((p) => p.year === year);
                    const yearPlotEMI = plotsInYear.reduce(
                        (sum, plot) => sum + plot.emi,
                        0,
                    );

                    if (plotsInYear.length > 0) {
                        cumulativeEMI += yearPlotEMI;
                        console.log(
                            `Year ${year}: Found ${plotsInYear.length} plots, EMI: ${yearPlotEMI}, Cumulative EMI: ${cumulativeEMI}`,
                        );
                    }

                    const foir = (cumulativeEMI / forecastedSalary) * 100;
                    const riskLevel =
                        foir > 40
                            ? "High Risk"
                            : foir > riskThreshold
                              ? "Moderate Risk"
                              : "Low Risk";
                    const riskClass =
                        foir > 40
                            ? "text-red-600"
                            : foir > riskThreshold
                              ? "text-yellow-600"
                              : "text-green-600";

                    timelineData.push({
                        year: year,
                        salary: forecastedSalary,
                        plots: plotsInYear,
                        yearPlotEMI: yearPlotEMI,
                        cumulativeEMI: cumulativeEMI,
                        foir: foir,
                        riskLevel: riskLevel,
                        riskClass: riskClass,
                    });
                }

                // Generate timeline HTML
                let timelineHTML = `
                    <div style="margin-bottom: 20px;">
                        <h4>Financial Timeline Overview (${currentYear} - ${currentYear + duration})</h4>
                        <div class="grid-3" style="margin: 15px 0;">
                            <div class="metric-row">
                                <span class="metric-label">Current FOIR</span>
                                <span class="metric-value">${((currentEMI / currentSalary) * 100).toFixed(1)}%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Total Plots Planned</span>
                                <span class="metric-value">${plots.length} Plots</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Risk Threshold</span>
                                <span class="metric-value">${riskThreshold}%</span>
                            </div>
                        </div>
                    </div>
                `;

                // Add warning if too many high-risk periods
                const highRiskYears = timelineData.filter(
                    (data) => data.foir > 40,
                ).length;
                if (highRiskYears > 3) {
                    timelineHTML += `
                        <div class="warning-box">
                            <strong><i class="fas fa-exclamation-triangle"></i> High Risk Alert!</strong>
                            <p>You have ${highRiskYears} years with high financial risk (FOIR > 40%).
                            Consider reducing plot purchases or increasing income to avoid financial stress.</p>
                        </div>
                    `;
                }

                // Timeline entries
                timelineData.forEach((data, index) => {
                    const isCurrentYear = data.year === currentYear;
                    const hasPlots = data.plots.length > 0;
                    const backgroundColor =
                        data.foir > 40
                            ? "#fee2e2"
                            : data.foir > riskThreshold
                              ? "#fef3c7"
                              : "#f0fdf4";
                    const borderColor =
                        data.foir > 40
                            ? "#ef4444"
                            : data.foir > riskThreshold
                              ? "#f59e0b"
                              : "#10b981";

                    timelineHTML += `
                        <div class="timeline-item" style="border-left: 3px solid ${borderColor}; padding-left: 15px; margin: 15px 0; background: ${backgroundColor}; padding: 15px; border-radius: 8px;">
                            <div class="metric-row">
                                <span class="metric-label">
                                    <span class="timeline-year ${isCurrentYear ? "current" : ""} ${hasPlots ? "has-plots" : ""}">${data.year} ${isCurrentYear ? "(Current)" : ""}</span>
                                    ${hasPlots ? `<span class="plot-purchase-badge">${data.plots.length} Plot(s) Purchase</span>` : ""}
                                </span>
                                <span class="metric-value ${data.riskClass}">${data.riskLevel}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Forecasted Salary</span>
                                <span class="metric-value">‚Çπ${Math.round(data.salary).toLocaleString()}</span>
                            </div>
                    `;

                    // Show plot details if any
                    if (hasPlots) {
                        timelineHTML += `
                            <div class="plot-details">
                                <h5>Plot Purchases:</h5>
                        `;
                        data.plots.forEach((plot) => {
                            timelineHTML += `
                                <div class="plot-item">
                                    ‚Ä¢ ${plot.size} sq ft @ ‚Çπ${plot.rate}/sq ft = ‚Çπ${(plot.size * plot.rate).toLocaleString()} (EMI: ‚Çπ${Math.round(plot.emi).toLocaleString()})
                                </div>
                            `;
                        });
                        timelineHTML += `
                                <div style="margin-top: 8px; font-weight: bold; color: #2563eb;">
                                    Year Total EMI: ‚Çπ${Math.round(data.yearPlotEMI).toLocaleString()}
                                </div>
                            </div>
                        `;
                    }

                    timelineHTML += `
                            <div class="metric-row">
                                <span class="metric-label">Combined Monthly EMI</span>
                                <span class="metric-value">‚Çπ${Math.round(data.cumulativeEMI).toLocaleString()}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">FOIR</span>
                                <span class="metric-value ${data.riskClass}">${data.foir.toFixed(1)}%</span>
                            </div>
                    `;

                    // Risk analysis
                    let riskAnalysis = "";
                    if (data.foir > 40) {
                        riskAnalysis = `<div class="risk-analysis high">
                            <strong>‚ö†Ô∏è HIGH RISK:</strong> FOIR exceeds 40%. If salary drops to ‚Çπ0, monthly EMI burden of ‚Çπ${Math.round(data.cumulativeEMI).toLocaleString()} could cause severe financial distress.
                        </div>`;
                    } else if (data.foir > riskThreshold) {
                        riskAnalysis = `<div class="risk-analysis moderate">
                            <strong>‚ö° MODERATE RISK:</strong> FOIR is ${data.foir.toFixed(1)}%. Monitor carefully as EMI burden is significant.
                        </div>`;
                    } else {
                        riskAnalysis = `<div class="risk-analysis low">
                            <strong>‚úÖ LOW RISK:</strong> FOIR is healthy at ${data.foir.toFixed(1)}%. Good financial position.
                        </div>`;
                    }

                    timelineHTML += riskAnalysis + "</div>";
                });

                // Summary
                const totalPlots = plots.length;
                const totalPlotValue = plots.reduce(
                    (sum, plot) => sum + plot.size * plot.rate,
                    0,
                );
                const totalPlotEMI = plots.reduce(
                    (sum, plot) => sum + plot.emi,
                    0,
                );
                const finalFOIR =
                    timelineData[timelineData.length - 1]?.foir || 0;

                timelineHTML += `
                    <div class="timeline-summary">
                        <h4>
                            <i class="fas fa-chart-bar"></i> Timeline Summary
                        </h4>
                        <div class="grid-2">
                            <div class="metric-row" style="border-bottom: 1px solid #475569;">
                                <span class="metric-label" style="color: #e2e8f0;">Total Plots</span>
                                <span class="metric-value" style="color: #10b981;">${totalPlots}</span>
                            </div>
                            <div class="metric-row" style="border-bottom: 1px solid #475569;">
                                <span class="metric-label" style="color: #e2e8f0;">Total Investment</span>
                                <span class="metric-value" style="color: #10b981;">‚Çπ${Math.round(totalPlotValue).toLocaleString()}</span>
                            </div>
                            <div class="metric-row" style="border-bottom: 1px solid #475569;">
                                <span class="metric-label" style="color: #e2e8f0;">Total Plot EMI</span>
                                <span class="metric-value" style="color: #f59e0b;">‚Çπ${Math.round(totalPlotEMI).toLocaleString()}</span>
                            </div>
                            <div class="metric-row" style="border-bottom: none;">
                                <span class="metric-label" style="color: #e2e8f0;">Final FOIR</span>
                                <span class="metric-value" style="color: ${finalFOIR > 40 ? "#ef4444" : finalFOIR > riskThreshold ? "#f59e0b" : "#10b981"};">${finalFOIR.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById("timelineContent").innerHTML =
                    timelineHTML;
            }

            // Initialize timeline on page load
            document.addEventListener("DOMContentLoaded", function () {
                // Add delay to ensure other elements are loaded
                setTimeout(() => {
                    updateTimelineView();
                    updateGrowthIndicators();
                    // Force update of all dashboard indicators
                    updateQuickCalculations();
                }, 100);
            });

            // Cleanup on page unload
            window.addEventListener("beforeunload", function () {
                if (dashboardChart) {
                    dashboardChart.destroy();
                }
            });

            function updateAllCalculations() {
                updateCurrentCalculations();
                updateQuickCalculations();
                updateGrowthIndicators();
                updateTimelineView();
            }

            // Export functionality
            function exportToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(20);
                doc.text("Plot Planner - Investment Report", 20, 20);

                doc.setFontSize(12);
                doc.text(
                    `Generated on: ${new Date().toLocaleDateString()}`,
                    20,
                    30,
                );

                // Add content
                doc.text("Current Home Loan Details:", 20, 50);
                doc.text(
                    `Total Project Cost: ${document.getElementById("totalProjectCost").textContent}`,
                    20,
                    60,
                );
                doc.text(
                    `Monthly EMI: ${document.getElementById("monthlyEMI").textContent}`,
                    20,
                    70,
                );

                // Add plot summary
                doc.text(`Total Plots Planned: ${plots.length}`, 20, 80);

                doc.save("plot-planner-report.pdf");
            }

            function printReport() {
                window.print();
            }
        </script>
    </body>
</html>
